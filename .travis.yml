language: python

python:
  - "3.4"

services:
  - postgresql
  #- elasticsearch

branches:
  only:
    - gabriel#35

env:
  - DJANGO=2.2

#before_install:
  #- export DJANGO_SETTINGS_MODULE=hashtagbrews.settings
  #- export PYTHONPATH="/home/travis/build/talaniz/hashtagbrews"
  #- export PIP_USE_MIRRORS=true

install:
  - pip install -r requirements.txt
  #- pip install django==$DJANGO --quiet
  #- pip install psycopg2 --quiet

before_script:
  - echo "SECRET_KEY=$SECRET_KEY" >> .env
  - echo "DB_NAME = 'portal'" >> .env
  - echo "DB_USER = 'gag'" >> .env
  - echo "DB_PASSWORD =$DB_PASSWORD" >> .env
  - echo "DB_HOST = 'localhost' " >> .env
  - echo "DB_PORT = '' " >> .env

  - psql -c "CREATE DATABASE portal;" -U postgres
  - psql -c "CREATE USER gag PASSWORD '$DB_PASSWORD';" -U postgres
  - psql -c "ALTER USER gag CREATEDB;" -U postgres
  - psql -c "GRANT ALL PRIVILEGES on DATABASE portal to gag;" -U postgres
  #- cp config/database.travis.yml config/database.yml
  #- "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start
  - python manage.py migrate

script:
  - python manage.py test homebrewdatabase.tests
  - python manage.py test functional_tests